import { spawnProcess } from './utils.js';

/**
 * Install mongodb community server on linux ubuntu
 * https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-ubuntu/
 */
export default async function mongo() {
  console.log('1. Import the public key used by the package management system');
  await spawnProcess('sh', [
    '-c',
    'wget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo apt-key add -',
  ]);

  console.log('2. Create a list file for MongoDB');
  await spawnProcess('sh', [
    '-c',
    'echo "deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.list',
  ]);

  console.log('3. Reload local package database');
  await spawnProcess('sudo', ['apt-get', 'update']);

  console.log('4. Install the MongoDB packages');
  await spawnProcess('sudo', ['apt-get', 'install', '-y', 'mongodb-org']);

  console.log('5. Start MongoDB Server');
  await spawnProcess('sudo', ['systemctl', 'start', 'mongod']);
}
